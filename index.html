<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì·¨ì†Œì–‘ì‹ ê´€ë¦¬ ì‹œìŠ¤í…œ</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="https://cdn.jsdelivr.net/npm/xlsx@0.18.5/dist/xlsx.full.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .header h1 {
            font-size: 2rem;
            margin-bottom: 0.5rem;
        }

        .header .team-info {
            font-size: 1.2rem;
            opacity: 0.9;
            margin-bottom: 1rem;
        }

        .user-info {
            position: absolute;
            top: 1rem;
            right: 1rem;
            text-align: right;
            background: rgba(255,255,255,0.1);
            padding: 0.5rem 1rem;
            border-radius: 10px;
        }

        .user-info .user-name {
            font-weight: bold;
            margin-bottom: 0.25rem;
        }

        .user-info button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.25rem 0.75rem;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            margin-left: 0.5rem;
            transition: all 0.3s ease;
        }

        .user-info button:hover {
            background: rgba(255,255,255,0.3);
        }

        .admin-controls {
            position: absolute;
            top: 1rem;
            left: 1rem;
        }

        .admin-controls button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid rgba(255,255,255,0.3);
            padding: 0.5rem 1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .admin-controls button:hover {
            background: rgba(255,255,255,0.3);
        }

        #adminInfo {
            display: none;
            align-items: center;
            gap: 1rem;
            background: rgba(255,255,255,0.2);
            padding: 0.5rem 1rem;
            border-radius: 5px;
        }

        .filter-section {
            padding: 1.5rem;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            display: flex;
            gap: 1rem;
            align-items: flex-end;
            flex-wrap: wrap;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .form-group label {
            font-weight: 600;
            color: #495057;
            font-size: 0.9rem;
        }

        .form-group input, .form-group select {
            padding: 0.5rem;
            border: 1px solid #ced4da;
            border-radius: 5px;
            font-size: 0.95rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.95rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .btn-danger {
            background: linear-gradient(135deg, #dc3545, #c82333);
            color: white;
        }

        .btn-danger:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(220, 53, 69, 0.4);
        }

        .no-permission-msg {
            display: none;
            background: #fff3cd;
            color: #856404;
            padding: 0.5rem 1rem;
            border-radius: 5px;
            border: 1px solid #ffeeba;
            align-items: center;
            gap: 0.5rem;
            margin-left: auto;
        }

        .table-container {
            padding: 1.5rem;
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        th {
            background: #f8f9fa;
            padding: 0.75rem;
            text-align: left;
            font-weight: 600;
            color: #495057;
            border-bottom: 2px solid #dee2e6;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        td {
            padding: 0.75rem;
            border-bottom: 1px solid #e9ecef;
            color: #212529;
        }

        tr:hover {
            background: #f8f9fa;
        }

        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 15px;
            font-size: 0.85rem;
            font-weight: 600;
            display: inline-block;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-approved {
            background: #d4edda;
            color: #155724;
        }

        .status-rejected {
            background: #f8d7da;
            color: #721c24;
        }

        .action-button {
            padding: 0.25rem 0.5rem;
            margin: 0 0.25rem;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .approve-btn {
            background: #28a745;
            color: white;
        }

        .approve-btn:hover {
            background: #218838;
        }

        .reject-btn {
            background: #dc3545;
            color: white;
        }

        .reject-btn:hover {
            background: #c82333;
        }

        .delete-btn {
            background: #6c757d;
            color: white;
        }

        .delete-btn:hover {
            background: #5a6268;
        }

        .detail-btn {
            background: #17a2b8;
            color: white;
        }

        .detail-btn:hover {
            background: #138496;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            animation: fadeIn 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 10px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 5px 30px rgba(0,0,0,0.3);
            animation: slideIn 0.3s;
        }

        @keyframes slideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1.5rem;
            border-radius: 10px 10px 0 0;
            position: relative;
        }

        .modal-header h2 {
            margin: 0;
        }

        .modal-body {
            padding: 1.5rem;
        }

        .modal-footer {
            padding: 1rem 1.5rem;
            background: #f8f9fa;
            border-radius: 0 0 10px 10px;
            display: flex;
            justify-content: flex-end;
            gap: 0.5rem;
        }

        .close {
            position: absolute;
            right: 1.5rem;
            top: 1.5rem;
            color: white;
            font-size: 1.5rem;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            opacity: 0.8;
        }

        .modal-field {
            margin-bottom: 1rem;
        }

        .modal-field label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #495057;
        }

        .modal-field p {
            margin: 0;
            padding: 0.5rem;
            background: #f8f9fa;
            border-radius: 5px;
        }

        /* í† ìŠ¤íŠ¸ ë©”ì‹œì§€ */
        .toast {
            position: fixed;
            bottom: 2rem;
            right: 2rem;
            padding: 1rem 1.5rem;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.2);
            display: flex;
            align-items: center;
            gap: 1rem;
            animation: slideInRight 0.3s;
            z-index: 2000;
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .toast.success {
            border-left: 4px solid #28a745;
        }

        .toast.error {
            border-left: 4px solid #dc3545;
        }

        .toast.info {
            border-left: 4px solid #17a2b8;
        }

        /* ì²´í¬ë°•ìŠ¤ ìŠ¤íƒ€ì¼ */
        .checkbox-cell {
            text-align: center;
        }

        .checkbox-cell input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }

        #deleteCount {
            background: rgba(255,255,255,0.3);
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.85rem;
        }

        /* ì´ˆê¸° í™”ë©´ ìŠ¤íƒ€ì¼ */
        .welcome-screen {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .welcome-card {
            background: white;
            padding: 3rem;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            text-align: center;
            min-width: 400px;
        }

        .welcome-card h2 {
            color: #495057;
            margin-bottom: 2rem;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-group input, .input-group select {
            width: 100%;
            padding: 0.75rem;
            border: 2px solid #e9ecef;
            border-radius: 10px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        .input-group input:focus, .input-group select:focus {
            outline: none;
            border-color: #667eea;
        }

        .input-group label {
            display: block;
            margin-bottom: 0.5rem;
            color: #495057;
            font-weight: 600;
            text-align: left;
        }

        .submit-btn {
            width: 100%;
            padding: 0.75rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 10px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: transform 0.3s;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        /* ì·¨ì†Œì‚¬ìœ  ì—´ë§Œ íŠ¹ë³„ ì²˜ë¦¬ */
        td:nth-child(9) {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
            font-size: 0.85rem;
        }

        /* ì¶”ê°€ ì •ë³´ ì—´ë„ ë¹„ìŠ·í•˜ê²Œ ì²˜ë¦¬ */
        td:nth-child(10) {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 250px;
        }
    </style>
</head>
<body>
    <!-- ì´ˆê¸° í™”ë©´ -->
    <div id="welcomeScreen" class="welcome-screen">
        <div class="welcome-card">
            <h2>ì·¨ì†Œì–‘ì‹ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>
            <div class="input-group">
                <label for="userName">ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”</label>
                <input type="text" id="userName" placeholder="ì˜ˆ: í™ê¸¸ë™">
            </div>
            <div class="input-group">
                <label for="teamSelect">íŒ€ì„ ì„ íƒí•˜ì„¸ìš”</label>
                <select id="teamSelect">
                    <option value="">íŒ€ ì„ íƒ...</option>
                    <option value="ì˜ì •ë¶€ SNSíŒ€">ì˜ì •ë¶€ SNSíŒ€</option>
                    <option value="SNS 1íŒ€">SNS 1íŒ€</option>
                    <option value="SNS 2íŒ€">SNS 2íŒ€</option>
                    <option value="SNS 3íŒ€">SNS 3íŒ€</option>
                    <option value="ëŒ€ì „ë§ˆì¼€íŒ…íŒ€">ëŒ€ì „ë§ˆì¼€íŒ…íŒ€</option>
                    <option value="ëŒ€êµ¬ë§ˆì¼€íŒ…íŒ€">ëŒ€êµ¬ë§ˆì¼€íŒ…íŒ€</option>
                </select>
            </div>
            <button class="submit-btn" onclick="window.initializeUser()">ì‹œì‘í•˜ê¸°</button>
        </div>
    </div>

    <!-- ë©”ì¸ í™”ë©´ -->
    <div id="mainScreen" class="container" style="display: none;">
        <div class="header">
            <div class="admin-controls">
                <button id="btnAdminLogin" onclick="window.showAdminLogin()">ğŸ” ê´€ë¦¬ì ë¡œê·¸ì¸</button>
                <div id="adminInfo">
                    <span>ğŸ‘¤ ê´€ë¦¬ì: <strong id="adminName"></strong></span>
                    <button onclick="window.adminLogout()">ë¡œê·¸ì•„ì›ƒ</button>
                </div>
            </div>
            <h1>ì·¨ì†Œì–‘ì‹ ê´€ë¦¬ ì‹œìŠ¤í…œ</h1>
            <div class="team-info">
                <span id="currentTeamDisplay"></span>
            </div>
            <div class="user-info">
                <div class="user-name">ğŸ‘¤ <span id="currentUserName"></span></div>
                <button onclick="window.changeUserName()">ë³€ê²½</button>
                <button onclick="window.changeTeam()">íŒ€ ë³€ê²½</button>
            </div>
        </div>

        <div class="filter-section">
            <div class="form-group" style="max-width: 150px;">
                <label for="filterDate">ë‚ ì§œ í•„í„°</label>
                <input type="date" id="filterDate" onchange="window.loadData()">
            </div>
            <button class="btn btn-secondary" id="btnExportExcel" onclick="window.handleExportExcel()">
                <span>ğŸ“¥</span>
                <span>ì—‘ì…€ ë‹¤ìš´ë¡œë“œ</span>
            </button>
            <button class="btn btn-danger" id="btnBulkDelete" onclick="window.handleBulkDelete()" style="display: none;">
                <span>ğŸ—‘ï¸</span>
                <span>ì„ íƒ ì‚­ì œ</span>
                <span id="deleteCount"></span>
            </button>
            <button class="btn btn-danger" id="btnDeleteAll" onclick="window.handleDeleteAll()" style="display: none; background: linear-gradient(135deg, #991b1b, #7f1d1d);">
                <span>âš ï¸</span>
                <span>ì „ì²´ ì‚­ì œ</span>
            </button>
            <button class="btn btn-primary" onclick="window.loadData()">
                <span>ğŸ”„</span>
                <span>ìƒˆë¡œê³ ì¹¨</span>
            </button>
            <div class="no-permission-msg" id="noPermissionMsg">
                ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤
            </div>
        </div>

        <div class="table-container">
            <table id="dataTable">
                <thead>
                    <tr>
                        <th class="checkbox-cell">
                            <input type="checkbox" id="selectAll" onchange="window.toggleSelectAll()">
                        </th>
                        <th>ì‘ì„±ì¼</th>
                        <th>íŒ€</th>
                        <th>ì‘ì„±ì‹œê°„</th>
                        <th>ëª¨ì§‘ì</th>
                        <th>ì·¨ì†Œì</th>
                        <th>ê³ ê°ëª…</th>
                        <th>ì—°ë½ì²˜</th>
                        <th>êµ¬ë¶„</th>
                        <th>ì·¨ì†Œì‚¬ìœ </th>
                        <th>ì¶”ê°€ ì •ë³´</th>
                        <th>ìƒíƒœ</th>
                        <th>ì‘ì—…</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                    <!-- ë°ì´í„°ê°€ ì—¬ê¸°ì— ë™ì ìœ¼ë¡œ ì¶”ê°€ë©ë‹ˆë‹¤ -->
                </tbody>
            </table>
        </div>
    </div>

    <!-- ìƒì„¸ ëª¨ë‹¬ -->
    <div id="detailModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ìƒì„¸ ì •ë³´</h2>
                <span class="close" onclick="document.getElementById('detailModal').style.display='none'">&times;</span>
            </div>
            <div class="modal-body" id="detailContent">
                <!-- ìƒì„¸ ë‚´ìš©ì´ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤ -->
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="document.getElementById('detailModal').style.display='none'">ë‹«ê¸°</button>
            </div>
        </div>
    </div>

    <!-- ì¸ì¦ ëª¨ë‹¬ -->
    <div id="authModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ê´€ë¦¬ì ì¸ì¦</h2>
                <span class="close" onclick="window.closeAuthModal()">&times;</span>
            </div>
            <div class="modal-body">
                <div class="modal-field">
                    <label for="authAdminName">ê´€ë¦¬ì ì´ë¦„</label>
                    <input type="text" id="authAdminName" placeholder="ê´€ë¦¬ì ì´ë¦„ ì…ë ¥">
                </div>
                <div class="modal-field">
                    <label for="authPassword">ë¹„ë°€ë²ˆí˜¸</label>
                    <input type="password" id="authPassword" placeholder="ë¹„ë°€ë²ˆí˜¸ ì…ë ¥">
                </div>
                <div class="modal-field">
                    <label>
                        <input type="checkbox" id="saveAuth"> ë¡œê·¸ì¸ ìœ ì§€
                    </label>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeAuthModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" onclick="window.verifyAdmin()">í™•ì¸</button>
            </div>
        </div>
    </div>

    <!-- í™•ì¸ ëª¨ë‹¬ -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="confirmTitle">í™•ì¸</h2>
                <span class="close" onclick="window.closeConfirmModal()">&times;</span>
            </div>
            <div class="modal-body">
                <p id="confirmMessage"></p>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="window.closeConfirmModal()">ì·¨ì†Œ</button>
                <button class="btn btn-primary" id="confirmButton">í™•ì¸</button>
            </div>
        </div>
    </div>

    <script>
        // Supabase í´ë¼ì´ì–¸íŠ¸ ì´ˆê¸°í™”
        const supabaseUrl = 'https://ynyxfpyhmpoepuzozfyt.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6InlueXhmcHlobXBvZXB1em96Znl0Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjM2MjU3NTMsImV4cCI6MjAzOTIwMTc1M30.8dSMViCJGnGifDX41s7FbBKVMaQtDpWYVWvQp4VAJzU';
        const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

        // ì „ì—­ ë³€ìˆ˜
        let currentUser = '';
        let currentTeam = '';
        let isAdmin = false;
        let allData = [];
        let selectedItems = new Set();
        let currentAuthAction = null;
        let currentAuthData = null;

        // íŒ€ ì´ë¦„ ê°„ì†Œí™” í•¨ìˆ˜
        window.getShortTeamName = function(teamName) {
            if (teamName === 'ì˜ì •ë¶€ SNSíŒ€') return 'ì˜ì •ë¶€';
            if (teamName && teamName.includes('SNS')) {
                // SNS 1íŒ€ -> 1íŒ€ í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
                return teamName.replace('SNS ', '');
            }
            return teamName;
        };

        // ì´ˆê¸°í™”
        window.initializeUser = function() {
            const userName = document.getElementById('userName').value.trim();
            const teamSelect = document.getElementById('teamSelect').value;

            if (!userName) {
                alert('ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (!teamSelect) {
                alert('íŒ€ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }

            currentUser = userName;
            currentTeam = teamSelect;
            localStorage.setItem('userName', userName);
            localStorage.setItem('userTeam', teamSelect);

            document.getElementById('welcomeScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('currentUserName').textContent = userName;
            document.getElementById('currentTeamDisplay').textContent = teamSelect;

            // ê´€ë¦¬ì ìƒíƒœ í™•ì¸
            const savedAdminName = localStorage.getItem('adminName');
            const savedAdminPassword = localStorage.getItem('adminPassword');
            
            if (savedAdminName && savedAdminPassword === '1250') {
                isAdmin = true;
                document.getElementById('btnAdminLogin').style.display = 'none';
                document.getElementById('adminInfo').style.display = 'flex';
                document.getElementById('adminName').textContent = savedAdminName;
            }

            window.loadData();
        };

        // ì‚¬ìš©ì ì´ë¦„ ë³€ê²½
        window.changeUserName = function() {
            const newName = prompt('ìƒˆë¡œìš´ ì´ë¦„ì„ ì…ë ¥í•˜ì„¸ìš”:', currentUser);
            if (newName && newName.trim()) {
                currentUser = newName.trim();
                localStorage.setItem('userName', currentUser);
                document.getElementById('currentUserName').textContent = currentUser;
                window.showToast('ì´ë¦„ì´ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            }
        };

        // íŒ€ ë³€ê²½
        window.changeTeam = function() {
            document.getElementById('welcomeScreen').style.display = 'flex';
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('userName').value = currentUser;
        };

        // ê´€ë¦¬ì ë¡œê·¸ì¸ í‘œì‹œ
        window.showAdminLogin = function() {
            document.getElementById('authModal').style.display = 'block';
            document.getElementById('authAdminName').value = '';
            document.getElementById('authPassword').value = '';
            document.getElementById('authAdminName').focus();
        };

        // ê´€ë¦¬ì ì¸ì¦
        window.verifyAdmin = function() {
            const name = document.getElementById('authAdminName').value.trim();
            const password = document.getElementById('authPassword').value;
            const saveAuth = document.getElementById('saveAuth').checked;

            if (!name) {
                window.showToast('ê´€ë¦¬ì ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.', 'error');
                return;
            }

            if (password !== '1250') {
                window.showToast('ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.', 'error');
                document.getElementById('authPassword').value = '';
                document.getElementById('authPassword').focus();
                return;
            }

            isAdmin = true;
            
            if (saveAuth) {
                localStorage.setItem('adminName', name);
                localStorage.setItem('adminPassword', password);
            }

            document.getElementById('btnAdminLogin').style.display = 'none';
            document.getElementById('adminInfo').style.display = 'flex';
            document.getElementById('adminName').textContent = name;
            
            window.closeAuthModal();
            window.checkPermissions();
            window.showToast(`${name}ë‹˜ ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'success');

            if (currentAuthAction) {
                window.handleAuthSuccess(name);
            }
        };

        // ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ
        window.adminLogout = function() {
            if (confirm('ê´€ë¦¬ì ë¡œê·¸ì•„ì›ƒ í•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                isAdmin = false;
                localStorage.removeItem('adminName');
                localStorage.removeItem('adminPassword');
                document.getElementById('btnAdminLogin').style.display = 'block';
                document.getElementById('adminInfo').style.display = 'none';
                window.checkPermissions();
                window.showToast('ë¡œê·¸ì•„ì›ƒë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
            }
        };

        // ëª¨ë‹¬ ë‹«ê¸°
        window.closeAuthModal = function() {
            document.getElementById('authModal').style.display = 'none';
            currentAuthAction = null;
            currentAuthData = null;
        };

        window.closeConfirmModal = function() {
            document.getElementById('confirmModal').style.display = 'none';
        };

        // ì¸ì¦ ì„±ê³µ í›„ ì²˜ë¦¬
        window.handleAuthSuccess = function(adminName) {
            if (!currentAuthAction) return;

            switch (currentAuthAction) {
                case 'approve':
                    window.performApprove(currentAuthData, adminName);
                    break;
                case 'reject':
                    window.performReject(currentAuthData, adminName);
                    break;
                case 'delete':
                    window.performDelete(currentAuthData, adminName);
                    break;
            }

            currentAuthAction = null;
            currentAuthData = null;
        };

        // ê¶Œí•œ í™•ì¸
        window.requireAuth = function(action, data) {
            if (!isAdmin) {
                currentAuthAction = action;
                currentAuthData = data;
                window.showAdminLogin();
                window.showToast('ì´ ì‘ì—…ì„ ìˆ˜í–‰í•˜ë ¤ë©´ ê´€ë¦¬ìë¡œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.', 'error');
                return false;
            }
            
            currentAuthAction = action;
            currentAuthData = data;
            
            const adminName = localStorage.getItem('adminName');
            if (adminName) {
                window.handleAuthSuccess(adminName);
            }
            return true;
        };

        // ìŠ¹ì¸ ì²˜ë¦¬
        window.handleApprove = function(id) {
            window.requireAuth('approve', id);
        };

        window.performApprove = async function(id, adminName) {
            try {
                const { error } = await supabase
                    .from('cancellations')
                    .update({ 
                        status: 'approved',
                        approved_by: adminName,
                        approved_at: new Date().toISOString()
                    })
                    .eq('id', id);

                if (error) throw error;

                window.showToast(`ìŠ¹ì¸ë˜ì—ˆìŠµë‹ˆë‹¤. (ìŠ¹ì¸ì: ${adminName})`, 'success');
                window.loadData();
            } catch (error) {
                window.showToast('ìŠ¹ì¸ ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        };

        // ê±°ì ˆ ì²˜ë¦¬
        window.handleReject = function(id) {
            window.requireAuth('reject', id);
        };

        window.performReject = async function(id, adminName) {
            try {
                const { error } = await supabase
                    .from('cancellations')
                    .update({ 
                        status: 'rejected',
                        rejected_by: adminName,
                        rejected_at: new Date().toISOString()
                    })
                    .eq('id', id);

                if (error) throw error;

                window.showToast(`ê±°ì ˆë˜ì—ˆìŠµë‹ˆë‹¤. (ê±°ì ˆì: ${adminName})`, 'success');
                window.loadData();
            } catch (error) {
                window.showToast('ê±°ì ˆ ì²˜ë¦¬ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        };

        // ê°œë³„ ì‚­ì œ ì²˜ë¦¬ (ê°„ì†Œí™”)
        window.handleSingleDelete = async function(id) {
            if (!isAdmin) {
                window.showToast('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            if (confirm('ì´ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    const { error } = await supabase
                        .from('cancellations')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                    
                    const adminName = localStorage.getItem('adminName') || 'ê´€ë¦¬ì';
                    window.showToast(`ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ì‚­ì œì: ${adminName})`, 'success');
                    window.loadData();
                    
                } catch (error) {
                    window.showToast('ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
                }
            }
        };

        // ì¼ê´„ ì‚­ì œ ì²˜ë¦¬
        window.handleBulkDelete = async function() {
            if (!isAdmin) {
                window.showToast('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            if (selectedItems.size === 0) {
                window.showToast('ì‚­ì œí•  í•­ëª©ì„ ì„ íƒí•´ì£¼ì„¸ìš”.', 'error');
                return;
            }
            
            const confirmMsg = `ì •ë§ë¡œ ì„ íƒí•œ ${selectedItems.size}ê°œ í•­ëª©ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nâš ï¸ ê²½ê³ : ì‚­ì œëœ ë°ì´í„°ëŠ” ë³µêµ¬í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            // ë‘ ë²ˆì§¸ í™•ì¸
            const secondConfirm = prompt(`ì‚­ì œë¥¼ ì§„í–‰í•˜ë ¤ë©´ "ì‚­ì œí™•ì¸"ì„ ì…ë ¥í•˜ì„¸ìš”.`);
            
            if (secondConfirm !== 'ì‚­ì œí™•ì¸') {
                window.showToast('ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                return;
            }
            
            try {
                const itemsArray = Array.from(selectedItems);
                
                // ê° í•­ëª© ì‚­ì œ
                for (const id of itemsArray) {
                    const { error } = await supabase
                        .from('cancellations')
                        .delete()
                        .eq('id', id);
                    
                    if (error) throw error;
                }
                
                const adminName = localStorage.getItem('adminName') || 'ê´€ë¦¬ì';
                window.showToast(`${selectedItems.size}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ì‚­ì œì: ${adminName})`, 'success');
                
                // ì„ íƒ ì´ˆê¸°í™”
                selectedItems.clear();
                const selectAll = document.getElementById('selectAll');
                if (selectAll) selectAll.checked = false;
                updateDeleteButton();
                
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                window.loadData();
                
            } catch (error) {
                window.showToast('ì¼ê´„ ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        };

        // ì „ì²´ ì‚­ì œ ì²˜ë¦¬
        window.handleDeleteAll = async function() {
            if (!isAdmin) {
                window.showToast('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }
            
            if (!allData || allData.length === 0) {
                window.showToast('ì‚­ì œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }
            
            // í•„í„° ìƒíƒœ í™•ì¸
            const dateFilter = document.getElementById('filterDate').value;
            const isFiltered = dateFilter !== '';
            
            // ì „ì²´ ë°ì´í„° ê°œìˆ˜ í™•ì¸
            let totalCount = allData.length;
            let deleteMessage = '';
            
            if (isFiltered) {
                deleteMessage = `í˜„ì¬ í•„í„°ë§ëœ ${totalCount}ê°œì˜ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            } else {
                deleteMessage = `${currentTeam}ì˜ ëª¨ë“  ${totalCount}ê°œ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?`;
            }
            
            const confirmMsg = `âš ï¸âš ï¸ ê²½ê³  âš ï¸âš ï¸\n\n${deleteMessage}\n\nì´ ì‘ì—…ì€ ë˜ëŒë¦´ ìˆ˜ ì—†ìŠµë‹ˆë‹¤!`;
            
            if (!confirm(confirmMsg)) {
                return;
            }
            
            // ë‘ ë²ˆì§¸ í™•ì¸
            const secondConfirm = prompt(`ì •ë§ë¡œ ëª¨ë“  ë°ì´í„°ë¥¼ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?\n\nìµœì¢… í™•ì¸ì„ ìœ„í•´ "ì „ì²´ì‚­ì œí™•ì¸"ì„ ì…ë ¥í•˜ì„¸ìš”.`);
            
            if (secondConfirm !== 'ì „ì²´ì‚­ì œí™•ì¸') {
                window.showToast('ì „ì²´ ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                return;
            }
            
            // ì„¸ ë²ˆì§¸ í™•ì¸
            const finalConfirm = confirm(`âš ï¸ ìµœì¢… ê²½ê³ !\n\n${totalCount}ê°œì˜ ëª¨ë“  ë°ì´í„°ê°€ ì˜êµ¬ì ìœ¼ë¡œ ì‚­ì œë©ë‹ˆë‹¤.\nì •ë§ ì§„í–‰í•˜ì‹œê² ìŠµë‹ˆê¹Œ?`);
            
            if (!finalConfirm) {
                window.showToast('ì „ì²´ ì‚­ì œê°€ ì·¨ì†Œë˜ì—ˆìŠµë‹ˆë‹¤.', 'info');
                return;
            }
            
            try {
                // ì‚­ì œí•  ë°ì´í„° ê²°ì •
                let dataToDelete = allData;
                
                // ê° í•­ëª© ì‚­ì œ
                for (const item of dataToDelete) {
                    const { error } = await supabase
                        .from('cancellations')
                        .delete()
                        .eq('id', item.id);
                    
                    if (error) throw error;
                }
                
                const adminName = localStorage.getItem('adminName') || 'ê´€ë¦¬ì';
                window.showToast(`ì „ì²´ ${dataToDelete.length}ê°œ í•­ëª©ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. (ì‚­ì œì: ${adminName})`, 'success');
                
                // ì„ íƒ ì´ˆê¸°í™”
                selectedItems.clear();
                const selectAll = document.getElementById('selectAll');
                if (selectAll) selectAll.checked = false;
                updateDeleteButton();
                
                // ë°ì´í„° ìƒˆë¡œê³ ì¹¨
                window.loadData();
                
            } catch (error) {
                window.showToast('ì „ì²´ ì‚­ì œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        };

        // ì²´í¬ë°•ìŠ¤ ì „ì²´ ì„ íƒ/í•´ì œ
        window.toggleSelectAll = function() {
            const selectAll = document.getElementById('selectAll');
            const checkboxes = document.querySelectorAll('.item-checkbox');
            
            checkboxes.forEach(checkbox => {
                checkbox.checked = selectAll.checked;
                const id = parseInt(checkbox.dataset.id);
                if (selectAll.checked) {
                    selectedItems.add(id);
                } else {
                    selectedItems.delete(id);
                }
            });
            
            updateDeleteButton();
        };

        // ê°œë³„ ì²´í¬ë°•ìŠ¤ í† ê¸€
        window.toggleItemSelection = function(id) {
            const checkbox = document.querySelector(`.item-checkbox[data-id="${id}"]`);
            if (checkbox.checked) {
                selectedItems.add(id);
            } else {
                selectedItems.delete(id);
            }
            
            // ì „ì²´ ì„ íƒ ì²´í¬ë°•ìŠ¤ ì—…ë°ì´íŠ¸
            const allCheckboxes = document.querySelectorAll('.item-checkbox');
            const selectAll = document.getElementById('selectAll');
            selectAll.checked = selectedItems.size === allCheckboxes.length && allCheckboxes.length > 0;
            
            updateDeleteButton();
        };

        // ì‚­ì œ ë²„íŠ¼ ì—…ë°ì´íŠ¸
        function updateDeleteButton() {
            const deleteBtn = document.getElementById('btnBulkDelete');
            const deleteCount = document.getElementById('deleteCount');
            
            if (selectedItems.size > 0) {
                deleteCount.textContent = `(${selectedItems.size})`;
            } else {
                deleteCount.textContent = '';
            }
        }

        // ê¶Œí•œ ì²´í¬ ë° UI ì—…ë°ì´íŠ¸
        window.checkPermissions = function() {
            const exportBtn = document.getElementById('btnExportExcel');
            const bulkDeleteBtn = document.getElementById('btnBulkDelete');
            const deleteAllBtn = document.getElementById('btnDeleteAll');
            const noPermissionMsg = document.getElementById('noPermissionMsg');
            
            if (isAdmin) {
                exportBtn.style.display = 'inline-flex';
                bulkDeleteBtn.style.display = 'inline-flex';
                deleteAllBtn.style.display = 'inline-flex';
                noPermissionMsg.style.display = 'none';
                document.querySelectorAll('.action-button').forEach(btn => {
                    btn.style.display = 'inline-block';
                });
                // ì²´í¬ë°•ìŠ¤ ì—´ í‘œì‹œ
                document.querySelector('th:first-child').style.display = 'table-cell';
                document.querySelectorAll('td:first-child').forEach(td => {
                    td.style.display = 'table-cell';
                });
            } else {
                exportBtn.style.display = 'none';
                bulkDeleteBtn.style.display = 'none';
                deleteAllBtn.style.display = 'none';
                noPermissionMsg.style.display = 'flex';
                document.querySelectorAll('.action-button').forEach(btn => {
                    btn.style.display = 'none';
                });
                // ì²´í¬ë°•ìŠ¤ ì—´ ìˆ¨ê¸°ê¸°
                document.querySelector('th:first-child').style.display = 'none';
                document.querySelectorAll('td:first-child').forEach(td => {
                    td.style.display = 'none';
                });
            }
        };

        // ë°ì´í„° ë¡œë“œ
        window.loadData = async function() {
            try {
                let query = supabase
                    .from('cancellations')
                    .select('*')
                    .eq('team', currentTeam)
                    .order('created_at', { ascending: false });

                const filterDate = document.getElementById('filterDate').value;
                if (filterDate) {
                    const startDate = new Date(filterDate);
                    startDate.setHours(0, 0, 0, 0);
                    const endDate = new Date(filterDate);
                    endDate.setHours(23, 59, 59, 999);

                    query = query
                        .gte('created_at', startDate.toISOString())
                        .lte('created_at', endDate.toISOString());
                }

                const { data, error } = await query;

                if (error) throw error;

                allData = data || [];
                displayData(allData);
                window.checkPermissions();

            } catch (error) {
                console.error('ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                window.showToast('ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.', 'error');
            }
        };

        // ë°ì´í„° í‘œì‹œ
        function displayData(data) {
            const tbody = document.getElementById('tableBody');
            tbody.innerHTML = '';

            if (data.length === 0) {
                tbody.innerHTML = '<tr><td colspan="13" style="text-align: center; padding: 2rem;">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</td></tr>';
                return;
            }

            data.forEach(item => {
                const date = new Date(item.created_at);
                const dateStr = date.toLocaleDateString('ko-KR');
                const timeStr = date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' });
                
                const statusClass = item.status === 'approved' ? 'status-approved' : 
                                  item.status === 'rejected' ? 'status-rejected' : 'status-pending';
                const statusText = item.status === 'approved' ? 'ìŠ¹ì¸' : 
                                 item.status === 'rejected' ? 'ê±°ì ˆ' : 'ëŒ€ê¸°';

                // íŒ€ ì´ë¦„ì„ ê°„ì†Œí™”
                const shortTeamName = window.getShortTeamName(item.team);

                // CRM ì…ë ¥ ë©”ì‹œì§€ ì²˜ë¦¬
                const crmText = item.crm_input || '-';

                const row = document.createElement('tr');
                row.innerHTML = `
                    <td class="checkbox-cell">
                        <input type="checkbox" class="item-checkbox" data-id="${item.id}" onchange="window.toggleItemSelection(${item.id})">
                    </td>
                    <td>${dateStr}</td>
                    <td>${shortTeamName}</td>
                    <td>${timeStr}</td>
                    <td>${item.recruiter}</td>
                    <td>${item.canceller}</td>
                    <td>${item.customer_name}</td>
                    <td>${item.customer_phone}</td>
                    <td>${item.category || '-'}</td>
                    <td title="${crmText.replace(/"/g, '&quot;')}">${crmText.replace(/\n/g, ' ')}</td>
                    <td>${item.additional_info || '-'}</td>
                    <td><span class="status-badge ${statusClass}">${statusText}</span></td>
                    <td>
                        <button class="action-button detail-btn" onclick="window.showDetail(${item.id})">ìƒì„¸</button>
                        <button class="action-button approve-btn" onclick="window.handleApprove(${item.id})">ìŠ¹ì¸</button>
                        <button class="action-button reject-btn" onclick="window.handleReject(${item.id})">ê±°ì ˆ</button>
                        <button class="action-button delete-btn" onclick="window.handleSingleDelete(${item.id})">ì‚­ì œ</button>
                    </td>
                `;
                tbody.appendChild(row);
            });

            // ì„ íƒ ìƒíƒœ ì´ˆê¸°í™”
            selectedItems.clear();
            document.getElementById('selectAll').checked = false;
            updateDeleteButton();
        }

        // ìƒì„¸ ì •ë³´ í‘œì‹œ
        window.showDetail = function(id) {
            const item = allData.find(d => d.id === id);
            if (!item) return;

            const date = new Date(item.created_at);
            const content = `
                <div class="modal-field">
                    <label>ì‘ì„±ì¼ì‹œ</label>
                    <p>${date.toLocaleString('ko-KR')}</p>
                </div>
                <div class="modal-field">
                    <label>íŒ€</label>
                    <p>${item.team}</p>
                </div>
                <div class="modal-field">
                    <label>ëª¨ì§‘ì</label>
                    <p>${item.recruiter}</p>
                </div>
                <div class="modal-field">
                    <label>ì·¨ì†Œì</label>
                    <p>${item.canceller}</p>
                </div>
                <div class="modal-field">
                    <label>ê³ ê°ëª…</label>
                    <p>${item.customer_name}</p>
                </div>
                <div class="modal-field">
                    <label>ì—°ë½ì²˜</label>
                    <p>${item.customer_phone}</p>
                </div>
                <div class="modal-field">
                    <label>êµ¬ë¶„</label>
                    <p>${item.category || '-'}</p>
                </div>
                <div class="modal-field">
                    <label>CRM ì…ë ¥ ë©”ì‹œì§€</label>
                    <p style="white-space: pre-wrap;">${item.crm_input || '-'}</p>
                </div>
                <div class="modal-field">
                    <label>ì¶”ê°€ ì •ë³´</label>
                    <p>${item.additional_info || '-'}</p>
                </div>
                <div class="modal-field">
                    <label>ìƒíƒœ</label>
                    <p>${item.status === 'approved' ? 'ìŠ¹ì¸' : item.status === 'rejected' ? 'ê±°ì ˆ' : 'ëŒ€ê¸°'}</p>
                </div>
                ${item.approved_by ? `
                <div class="modal-field">
                    <label>ìŠ¹ì¸ì</label>
                    <p>${item.approved_by} (${new Date(item.approved_at).toLocaleString('ko-KR')})</p>
                </div>
                ` : ''}
                ${item.rejected_by ? `
                <div class="modal-field">
                    <label>ê±°ì ˆì</label>
                    <p>${item.rejected_by} (${new Date(item.rejected_at).toLocaleString('ko-KR')})</p>
                </div>
                ` : ''}
            `;

            document.getElementById('detailContent').innerHTML = content;
            document.getElementById('detailModal').style.display = 'block';
        };

        // ì—‘ì…€ ë‹¤ìš´ë¡œë“œ
        window.handleExportExcel = function() {
            if (!isAdmin) {
                window.showToast('ê´€ë¦¬ì ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.', 'error');
                return;
            }

            if (allData.length === 0) {
                window.showToast('ë‹¤ìš´ë¡œë“œí•  ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.', 'error');
                return;
            }

            try {
                const excelData = allData.map(item => {
                    const date = new Date(item.created_at);
                    return {
                        'ì‘ì„±ì¼': date.toLocaleDateString('ko-KR'),
                        'ì‘ì„±ì‹œê°„': date.toLocaleTimeString('ko-KR', { hour: '2-digit', minute: '2-digit' }),
                        'íŒ€': item.team,
                        'ëª¨ì§‘ì': item.recruiter,
                        'ì·¨ì†Œì': item.canceller,
                        'ê³ ê°ëª…': item.customer_name,
                        'ì—°ë½ì²˜': item.customer_phone,
                        'êµ¬ë¶„': item.category || '',
                        'CRM ì…ë ¥ ë©”ì‹œì§€': item.crm_input || '',
                        'ì¶”ê°€ ì •ë³´': item.additional_info || '',
                        'ìƒíƒœ': item.status === 'approved' ? 'ìŠ¹ì¸' : item.status === 'rejected' ? 'ê±°ì ˆ' : 'ëŒ€ê¸°',
                        'ìŠ¹ì¸ì': item.approved_by || '',
                        'ìŠ¹ì¸ì¼ì‹œ': item.approved_at ? new Date(item.approved_at).toLocaleString('ko-KR') : '',
                        'ê±°ì ˆì': item.rejected_by || '',
                        'ê±°ì ˆì¼ì‹œ': item.rejected_at ? new Date(item.rejected_at).toLocaleString('ko-KR') : ''
                    };
                });

                const ws = XLSX.utils.json_to_sheet(excelData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'ì·¨ì†Œì–‘ì‹');

                const fileName = `ì·¨ì†Œì–‘ì‹_${currentTeam}_${new Date().toISOString().split('T')[0]}.xlsx`;
                XLSX.writeFile(wb, fileName);

                const adminName = localStorage.getItem('adminName') || 'ê´€ë¦¬ì';
                window.showToast(`ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì™„ë£Œ (ë‹¤ìš´ë¡œë“œ: ${adminName})`, 'success');

            } catch (error) {
                window.showToast('ì—‘ì…€ ë‹¤ìš´ë¡œë“œ ì‹¤íŒ¨: ' + error.message, 'error');
            }
        };

        // í† ìŠ¤íŠ¸ ë©”ì‹œì§€
        window.showToast = function(message, type = 'info') {
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <span>${type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â„¹'}</span>
                <span>${message}</span>
            `;
            document.body.appendChild(toast);

            setTimeout(() => {
                toast.style.animation = 'slideOutRight 0.3s';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ì´ˆê¸°í™”
        window.onload = function() {
            const savedUserName = localStorage.getItem('userName');
            const savedTeam = localStorage.getItem('userTeam');

            if (savedUserName && savedTeam) {
                currentUser = savedUserName;
                currentTeam = savedTeam;
                document.getElementById('userName').value = savedUserName;
                document.getElementById('teamSelect').value = savedTeam;
                window.initializeUser();
            }

            // Enter í‚¤ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
            document.getElementById('userName').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    window.initializeUser();
                }
            });

            document.getElementById('authPassword').addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    window.verifyAdmin();
                }
            });

            // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ ë‹«ê¸°
            window.onclick = function(event) {
                const detailModal = document.getElementById('detailModal');
                const authModal = document.getElementById('authModal');
                const confirmModal = document.getElementById('confirmModal');
                
                if (event.target === detailModal) {
                    detailModal.style.display = 'none';
                }
                if (event.target === authModal) {
                    window.closeAuthModal();
                }
                if (event.target === confirmModal) {
                    window.closeConfirmModal();
                }
            };
        };
    </script>
</body>
</html>
